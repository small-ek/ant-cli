import{c as e,d as a,e as l,B as t,P as o,f as i,g as d,h as n,C as u,S as r,F as s,i as m,j as p,k as c,l as _,R as f,m as v,n as b,o as h,p as y,q as g,O as j}from"./@arco-design-Dokc0RKg.js";import{u as V}from"./vue-i18n-CqL9YciY.js";import{a as x}from"./axios-MiWXsb5I.js";import{H as k,g as w}from"./highlight.js-0X-Of3tq.js";import{a as $}from"./clipboard-BEQH_2kK.js";import{_ as q}from"./index-BpuSuUli.js";import{r as C,o as U,z as T,u as N,h as I,q as O,C as E,y as S,v as M,j as F,O as P,_ as z,F as B,m as G,a as L,s as H,N as K}from"./@vue-DZ7jDL3d.js";import"./scroll-into-view-if-needed-Cs7OIxrW.js";import"./compute-scroll-into-view-DCNUDwgY.js";import"./b-validate-Tl0hto4A.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./number-precision-E2hnQMPc.js";import"./@intlify-DUU-ascj.js";import"./vue-router-u33OXLSN.js";import"./nprogress-WYfz1aye.js";function R(){var e=x.create({baseURL:"http://127.0.0.1:49000/",timeout:15e3,headers:{}});return e.interceptors.request.use((e=>e),(e=>Promise.reject(e))),e.interceptors.response.use((e=>e),(e=>Promise.reject(e))),e}const W=e=>R().request({url:"api/table-field",method:"GET",params:e}),A=["innerHTML"],D=q({__name:"index",props:{visible:{type:Boolean,default:!1},preCode:{type:Object,default:{}}},emits:["update:visible"],setup(u,{emit:r}){const{t:s}=V(),m=C(1);U((()=>{T((()=>{document.querySelectorAll("pre").forEach((e=>{k.highlightElement(e,{language:w,theme:"monokai-sublime"})}))}))}));const p=u;let{visible:c,preCode:_}=N(p);const f=r,v=()=>{f("update:visible",!1)},b=()=>{$.copy(_.value[m.value-1].code),e.info({content:"复制成功",duration:2e3,id:"copy2"})},h=a=>{$.copy(_.value[a-1].code),e.info({content:"已复制",duration:2e3,id:"copy"})};return(e,u)=>{const r=n,p=a,y=l,g=t,j=o,V=i,x=d;return I(),O(x,{width:800,visible:z(c),onCancel:v,footer:!1,draggable:""},{title:E((()=>u[2]||(u[2]=[S(" 预览代码 ")]))),default:E((()=>[M(p,{"active-key":m.value,"onUpdate:activeKey":u[0]||(u[0]=e=>m.value=e),onChange:h},{default:E((()=>[(I(!0),F(B,null,P(z(_),((e,a)=>(I(),O(r,{key:a+1,title:e.name},{default:E((()=>[G("pre",null,[G("code",{class:"language-code",innerHTML:e.code},null,8,A)])])),_:2},1032,["title"])))),128))])),_:1},8,["active-key"]),G("div",null,[M(j,{content:z(s)("tips.is_gen_code"),type:"info",onOk:u[1]||(u[1]=e=>{f("generateCode",_.value[m.value-1].name)})},{default:E((()=>[M(g,{type:"primary",style:{"margin-right":"20px"}},{icon:E((()=>[M(y)])),default:E((()=>[u[3]||(u[3]=S(" 生成当前代码 "))])),_:1})])),_:1},8,["content"]),M(g,{type:"primary",style:{float:"right"},onClick:b},{icon:E((()=>[M(V)])),default:E((()=>[u[4]||(u[4]=S(" 复制 "))])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-60a5f4a4"]]),J={class:"container"},Q={style:{"margin-top":"15px","padding-bottom":"20px"}},X=q({__name:"index",setup(a){const{t:l}=V(),i=C([]),n=C([]),x=C([]),k=C([]),w=C(!1),$=C(!1),q=C({}),U=({values:e,errors:a})=>{void 0===a&&(0==N.value.update_index?x.value.push({comment:N.value.comment,field_name:N.value.field_name,field_type:"join",join_type:N.value.join_type,join_table:N.value.join_table,join_field:N.value.join_field,required:0,is_search:0,conditions:""}):x.value[N.value.update_index]={comment:N.value.comment,field_name:N.value.field_name,field_type:"join",join_type:N.value.join_type,join_table:N.value.join_table,join_field:N.value.join_field,required:0,is_search:0,conditions:""},w.value=!1)},T=L({dbname:"",table:"",package_name:"api",table_comment:""}),N=C({comment:"",field_name:"",field_type:"",join_table:"",join_field:"",join_type:"",update_index:0}),A={comment:[{required:!0,message:l("verify.comment")}],join_type:[{required:!0,message:l("verify.join_type")}],field_name:[{required:!0,message:l("verify.field_name")}],join_table:[{required:!0,message:l("verify.join_table")}],join_field:[{required:!0,message:l("verify.join_field")}]},X={dbname:[{required:!0,message:l("verify.databaseName")}],table:[{required:!0,message:l("verify.tableName")}],package_name:[{required:!0,message:l("verify.packageName")}]},Y=[{title:l("table_columns.comment"),dataIndex:"comment",ellipsis:!0,tooltip:!0,width:180},{title:l("table_columns.field_type"),dataIndex:"field_type",ellipsis:!0,tooltip:!0,width:100},{title:l("table_columns.field_name"),dataIndex:"field_name",ellipsis:!0,tooltip:!0,width:150},{title:l("table_columns.required"),dataIndex:"required",slotName:"required",width:155},{title:l("table_columns.is_search"),dataIndex:"is_search",slotName:"is_search",width:155},{title:l("table_columns.conditions"),dataIndex:"conditions",slotName:"conditions",width:120},{title:l("table_columns.option"),dataIndex:"option",slotName:"option",width:160}],Z=[{name:l("correlationModel.oneToOne"),value:"oneToOne"},{name:l("correlationModel.oneToMany"),value:"oneToMany"},{name:l("correlationModel.manyToMany"),value:"manyToMany"}];R().request({url:"api/database",method:"GET"}).then((e=>{i.value=e.data}));const ee=e=>{n.value.forEach((a=>{a.table_name==e&&(T.table_comment=a.table_comment)}))},ae=()=>{var e;(e={table:T.dbname},R().request({url:"api/table-list",method:"GET",params:e})).then((e=>{n.value=e.data}))},le=({values:e,errors:a})=>{void 0===a&&W({db:T.dbname,table:T.table}).then((e=>{const a=[];for(let l=0;l<e.data.length;l++)a.push({comment:e.data[l].comment,field_name:e.data[l].field_name,field_type:e.data[l].field_type,indexes:e.data[l].indexes,required:0,is_search:0});x.value=a}))},te=()=>{W({db:T.dbname,table:N.value.join_table}).then((e=>{k.value=e.data}))},oe=a=>{var t;""!==T.table&&0!==x.value.length&&""!==T.package_name?(t={table_name:T.table,fields:x.value,package:T.package_name,is_create:a,data_base:T.dbname,table_comment:T.table_comment},R().request({url:"api/code",method:"POST",data:t})).then((t=>{!1===a?$.value=!0:e.info(l("tips.generateSuccess")),q.value=t.data})).catch((()=>{e.error(l("tips.generateFail"))})):e.error(l("tips.fail"))},ie=a=>{var t;(t={table_name:T.table,fields:x.value,package:T.package_name,module_type:a,data_base:T.dbname,table_comment:T.table_comment},R().request({url:"api/generate_code",method:"POST",data:t})).then((a=>{e.info(l("tips.generateSuccess"))})).catch((()=>{e.error(l("tips.generateFail"))}))},de=["=","!=","<",">","<=",">=","LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN"];return(e,a)=>{const V=j,C=r,L=s,R=m,W=t,ne=p,ue=c,re=_,se=f,me=v,pe=b,ce=h,_e=y,fe=u,ve=d,be=g,he=o;return I(),F("div",J,[M(fe,{style:{width:"1200px",marginTop:"50px"},title:e.$t("code.generation"),hoverable:""},{default:E((()=>[M(ue,{rules:X,model:T,style:{width:"850px"},onSubmit:le},{default:E((()=>[M(L,{field:"dbname",label:e.$t("code.databaseName"),"validate-trigger":"blur"},{default:E((()=>[M(C,{modelValue:T.dbname,"onUpdate:modelValue":a[0]||(a[0]=e=>T.dbname=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:ae},{default:E((()=>[(I(!0),F(B,null,P(i.value,(e=>(I(),O(V,{value:e},{default:E((()=>[S(K(e),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),M(L,{field:"table",label:e.$t("code.tableName"),"validate-trigger":"blur"},{default:E((()=>[M(C,{modelValue:T.table,"onUpdate:modelValue":a[1]||(a[1]=e=>T.table=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:ee},{default:E((()=>[(I(!0),F(B,null,P(n.value,(e=>(I(),O(V,{value:e.table_name},{default:E((()=>[S(K(e.table_name)+K(e.table_comment?"\n("+e.table_comment+")":""),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),M(L,{field:"package_name",label:e.$t("code.packageName"),"validate-trigger":"blur"},{default:E((()=>[M(R,{modelValue:T.package_name,"onUpdate:modelValue":a[2]||(a[2]=e=>T.package_name=e),placeholder:e.$t("code.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),M(L,null,{default:E((()=>[M(ne,null,{default:E((()=>[M(W,{"html-type":"submit",type:"primary",shape:"round"},{default:E((()=>[S(K(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),M(W,{type:"primary",shape:"round",onClick:a[3]||(a[3]=e=>w.value=!0)},{icon:E((()=>[M(re)])),default:E((()=>[S(" "+K(e.$t("form.addField")),1)])),_:1}),M(_e,{style:{"margin-top":"10px"},stripe:!0,hoverable:!0,columns:Y,data:x.value,pagination:!1},{required:E((({rowIndex:a})=>["join"!=x.value[a].field_type?(I(),O(me,{key:0,modelValue:x.value[a].required,"onUpdate:modelValue":e=>x.value[a].required=e},{default:E((()=>[M(se,{value:1},{default:E((()=>[S(K(e.$t("tableSelect.ok")),1)])),_:1}),M(se,{value:0},{default:E((()=>[S(K(e.$t("tableSelect.no")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):H("",!0)])),is_search:E((({rowIndex:a})=>["join"!=x.value[a].field_type?(I(),O(me,{key:0,modelValue:x.value[a].is_search,"onUpdate:modelValue":e=>x.value[a].is_search=e},{default:E((()=>[M(se,{value:1},{default:E((()=>[S(K(e.$t("tableSelect.ok")),1)])),_:1}),M(se,{value:0},{default:E((()=>[S(K(e.$t("tableSelect.no")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):H("",!0)])),conditions:E((({rowIndex:a})=>[1==x.value[a].is_search?(I(),O(C,{key:0,style:{width:"100px"},modelValue:x.value[a].conditions,"onUpdate:modelValue":e=>x.value[a].conditions=e,placeholder:e.$t("code.select")},{default:E((()=>[(I(),F(B,null,P(de,(e=>M(V,{value:e},{default:E((()=>[S(K(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):H("",!0)])),option:E((({rowIndex:a})=>["join"==x.value[a].field_type?(I(),O(ne,{key:0},{default:E((()=>[M(W,{type:"text",style:{"margin-left":"10px"},shape:"round",size:"mini",onClick:e=>{return l=x.value[a],t=a,N.value={comment:l.comment,field_name:l.field_name,field_type:l.field_type,join_table:l.join_table,join_field:l.join_field,join_type:l.join_type,update_index:t},void(w.value=!0);var l,t}},{icon:E((()=>[M(pe)])),default:E((()=>[S(" "+K(e.$t("tableOption.edit")),1)])),_:2},1032,["onClick"]),M(W,{type:"text",status:"danger",shape:"round",size:"mini",onClick:e=>{return l=a,void x.value.splice(l,1);var l}},{icon:E((()=>[M(ce)])),default:E((()=>[S(" "+K(e.$t("tableOption.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)):H("",!0)])),_:1},8,["data"])])),_:1},8,["title"]),M(ve,{visible:w.value,"onUpdate:visible":a[9]||(a[9]=e=>w.value=e),footer:!1,draggable:""},{title:E((()=>a[14]||(a[14]=[S(" 编辑字段 ")]))),default:E((()=>[G("div",null,[M(ue,{model:N.value,rules:A,onSubmit:U},{default:E((()=>[M(L,{field:"comment",label:e.$t("form2.chinese_name")},{default:E((()=>[M(R,{modelValue:N.value.comment,"onUpdate:modelValue":a[4]||(a[4]=e=>N.value.comment=e)},null,8,["modelValue"])])),_:1},8,["label"]),M(L,{field:"join_type",label:e.$t("form2.join_type"),help:e.$t("form2.help")},{default:E((()=>[M(C,{placeholder:e.$t("code.select"),modelValue:N.value.join_type,"onUpdate:modelValue":a[5]||(a[5]=e=>N.value.join_type=e),"allow-clear":"","allow-search":""},{default:E((()=>[(I(),F(B,null,P(Z,(e=>M(V,{value:e.value},{default:E((()=>[S(K(e.name),1)])),_:2},1032,["value"]))),64))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label","help"]),M(L,{field:"field_name",label:e.$t("form2.field_name")},{default:E((()=>[M(C,{placeholder:e.$t("code.select"),modelValue:N.value.field_name,"onUpdate:modelValue":a[6]||(a[6]=e=>N.value.field_name=e),"allow-clear":"","allow-search":""},{default:E((()=>[(I(!0),F(B,null,P(x.value,(e=>(I(),O(V,{value:e.field_name},{default:E((()=>[S(K(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),M(L,{field:"join_table",label:e.$t("form2.join_table")},{default:E((()=>[M(C,{placeholder:e.$t("code.select"),modelValue:N.value.join_table,"onUpdate:modelValue":a[7]||(a[7]=e=>N.value.join_table=e),"allow-clear":"","allow-search":"",onChange:te},{default:E((()=>[(I(!0),F(B,null,P(n.value,(e=>(I(),O(V,{value:e.table_name},{default:E((()=>[S(K(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),M(L,{field:"join_field",label:e.$t("form2.join_field")},{default:E((()=>[M(C,{placeholder:e.$t("code.select"),modelValue:N.value.join_field,"onUpdate:modelValue":a[8]||(a[8]=e=>N.value.join_field=e),"allow-clear":"","allow-search":""},{default:E((()=>[(I(!0),F(B,null,P(k.value,(e=>(I(),O(V,{value:e.field_name},{default:E((()=>[S(K(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),M(L,null,{default:E((()=>[M(W,{"html-type":"submit",type:"primary",shape:"round"},{default:E((()=>[S(K(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"]),G("div",Q,[M(W,{type:"primary",shape:"round",onClick:a[10]||(a[10]=e=>oe(!1))},{icon:E((()=>[M(pe)])),default:E((()=>[S(" "+K(e.$t("tableOption.preview")),1)])),_:1}),M(he,{content:z(l)("tips.is_gen_code"),type:"info",onOk:a[11]||(a[11]=e=>oe(!0))},{default:E((()=>[M(W,{type:"primary",style:{"margin-left":"20px"},shape:"round"},{icon:E((()=>[M(be)])),default:E((()=>[S(" "+K(e.$t("tableOption.gen_code")),1)])),_:1})])),_:1},8,["content"])]),$.value?(I(),O(D,{key:0,visible:$.value,"onUpdate:visible":a[12]||(a[12]=e=>$.value=e),preCode:q.value,"onUpdate:preCode":a[13]||(a[13]=e=>q.value=e),onGenerateCode:ie},null,8,["visible","preCode"])):H("",!0)])}}},[["__scopeId","data-v-b3b83de9"]]);export{X as default};
