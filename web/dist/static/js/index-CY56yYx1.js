import{c as e,d as a,e as l,B as t,f as o,g as i,C as d,P as n,S as u,F as r,h as s,i as m,j as p,k as c,R as _,l as f,m as v,n as b,o as h,p as y,O as j}from"./@arco-design-BXNCjTR7.js";import{u as g}from"./vue-i18n-CqL9YciY.js";import{a as V}from"./axios-MiWXsb5I.js";import{H as x,g as k}from"./highlight.js-0X-Of3tq.js";import{a as w}from"./clipboard-BEQH_2kK.js";import{_ as $}from"./index-BmdPlMlq.js";import{r as q,o as C,z as U,u as N,h as T,q as I,C as E,y as O,v as S,j as M,O as z,_ as B,F,m as L,a as P,s as G,N as H}from"./@vue-DZ7jDL3d.js";import"./scroll-into-view-if-needed-Cs7OIxrW.js";import"./compute-scroll-into-view-DCNUDwgY.js";import"./b-validate-Tl0hto4A.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./number-precision-E2hnQMPc.js";import"./@intlify-DUU-ascj.js";import"./vue-router-u33OXLSN.js";import"./nprogress-WYfz1aye.js";function K(){var e=V.create({baseURL:"http://127.0.0.1:49000/",timeout:15e3,headers:{}});return e.interceptors.request.use((e=>e),(e=>Promise.reject(e))),e.interceptors.response.use((e=>e),(e=>Promise.reject(e))),e}const R=e=>K().request({url:"api/table-field",method:"GET",params:e}),W=["innerHTML"],A=$({__name:"index",props:{visible:{type:Boolean,default:!1},preCode:{type:Object,default:{}}},emits:["update:visible"],setup(d,{emit:n}){const u=q(1);C((()=>{U((()=>{document.querySelectorAll("pre").forEach((e=>{x.highlightElement(e,{language:k,theme:"monokai-sublime"})}))}))}));const r=d;let{visible:s,preCode:m}=N(r);const p=n,c=()=>{p("update:visible",!1)},_=()=>{w.copy(m.value[u.value-1].code),e.info({content:"复制成功",duration:2e3,id:"copy2"})},f=a=>{w.copy(m.value[a-1].code),e.info({content:"已复制",duration:2e3,id:"copy"})};return(e,d)=>{const n=i,r=a,p=l,v=t,b=o;return T(),I(b,{width:800,visible:B(s),onCancel:c,footer:!1,draggable:""},{title:E((()=>d[1]||(d[1]=[O(" 预览代码 ")]))),default:E((()=>[S(r,{"active-key":u.value,"onUpdate:activeKey":d[0]||(d[0]=e=>u.value=e),onChange:f},{default:E((()=>[(T(!0),M(F,null,z(B(m),((e,a)=>(T(),I(n,{key:a+1,title:e.name},{default:E((()=>[L("pre",null,[L("code",{class:"language-code",innerHTML:e.code},null,8,W)])])),_:2},1032,["title"])))),128))])),_:1},8,["active-key"]),L("div",null,[S(v,{type:"primary",style:{float:"right"},onClick:_},{icon:E((()=>[S(p)])),default:E((()=>[d[2]||(d[2]=O(" 复制 "))])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-74db95be"]]),D={class:"container"},J={style:{"margin-top":"15px"}},Q=$({__name:"index",setup(a){const{t:l}=g(),i=q([]),V=q([]),x=q([]),k=q([]),w=q(!1),$=q(!1),C=q({}),U=({values:e,errors:a})=>{void 0===a&&(0==W.value.update_index?x.value.push({comment:W.value.comment,field_name:W.value.field_name,field_type:"join",join_type:W.value.join_type,join_table:W.value.join_table,join_field:W.value.join_field,required:0,is_search:0,conditions:""}):x.value[W.value.update_index]={comment:W.value.comment,field_name:W.value.field_name,field_type:"join",join_type:W.value.join_type,join_table:W.value.join_table,join_field:W.value.join_field,required:0,is_search:0,conditions:""},w.value=!1)},N=P({dbname:"",table:"",package_name:"api",table_comment:""}),W=q({comment:"",field_name:"",field_type:"",join_table:"",join_field:"",join_type:"",update_index:0}),Q={comment:[{required:!0,message:l("verify.comment")}],join_type:[{required:!0,message:l("verify.join_type")}],field_name:[{required:!0,message:l("verify.field_name")}],join_table:[{required:!0,message:l("verify.join_table")}],join_field:[{required:!0,message:l("verify.join_field")}]},X={dbname:[{required:!0,message:l("verify.databaseName")}],table:[{required:!0,message:l("verify.tableName")}],package_name:[{required:!0,message:l("verify.packageName")}]},Y=[{title:l("table_columns.comment"),dataIndex:"comment",ellipsis:!0,tooltip:!0,width:140},{title:l("table_columns.field_type"),dataIndex:"field_type",ellipsis:!0,tooltip:!0,width:100},{title:l("table_columns.field_name"),dataIndex:"field_name",ellipsis:!0,tooltip:!0,width:130},{title:l("table_columns.required"),dataIndex:"required",slotName:"required",width:155},{title:l("table_columns.is_search"),dataIndex:"is_search",slotName:"is_search",width:155},{title:l("table_columns.conditions"),dataIndex:"conditions",slotName:"conditions",width:130},{title:l("table_columns.option"),dataIndex:"option",slotName:"option",width:160}],Z=[{name:l("correlationModel.oneToOne"),value:"oneToOne"},{name:l("correlationModel.oneToMany"),value:"oneToMany"},{name:l("correlationModel.manyToMany"),value:"manyToMany"}];K().request({url:"api/database",method:"GET"}).then((e=>{i.value=e.data}));const ee=e=>{V.value.forEach((a=>{a.table_name==e&&(N.table_comment=a.table_comment)}))},ae=()=>{var e;(e={table:N.dbname},K().request({url:"api/table-list",method:"GET",params:e})).then((e=>{V.value=e.data}))},le=({values:e,errors:a})=>{void 0===a&&R({db:N.dbname,table:N.table}).then((e=>{const a=[];for(let l=0;l<e.data.length;l++)a.push({comment:e.data[l].comment,field_name:e.data[l].field_name,field_type:e.data[l].field_type,indexes:e.data[l].indexes,required:0,is_search:0});x.value=a}))},te=()=>{R({db:N.dbname,table:W.value.join_table}).then((e=>{k.value=e.data}))},oe=a=>{var t;""!==N.table&&0!==x.value.length&&""!==N.package_name?(t={table_name:N.table,fields:x.value,package:N.package_name,is_create:a,data_base:N.dbname,table_comment:N.table_comment},K().request({url:"api/code",method:"POST",data:t})).then((t=>{!1===a?$.value=!0:e.info(l("tips.generateSuccess")),C.value=t.data})).catch((()=>{e.error(l("tips.generateFail"))})):e.error(l("tips.fail"))},ie=["=","!=","<",">","<=",">=","LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN"];return(e,a)=>{const g=j,q=u,P=r,K=s,R=t,de=m,ne=p,ue=c,re=_,se=f,me=v,pe=b,ce=h,_e=d,fe=o,ve=y,be=n;return T(),M("div",D,[S(_e,{style:{width:"1000px",marginTop:"50px"},title:e.$t("code.generation"),hoverable:""},{default:E((()=>[S(ne,{rules:X,model:N,style:{width:"850px"},onSubmit:le},{default:E((()=>[S(P,{field:"dbname",label:e.$t("code.databaseName"),"validate-trigger":"blur"},{default:E((()=>[S(q,{modelValue:N.dbname,"onUpdate:modelValue":a[0]||(a[0]=e=>N.dbname=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:ae},{default:E((()=>[(T(!0),M(F,null,z(i.value,(e=>(T(),I(g,{value:e},{default:E((()=>[O(H(e),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),S(P,{field:"table",label:e.$t("code.tableName"),"validate-trigger":"blur"},{default:E((()=>[S(q,{modelValue:N.table,"onUpdate:modelValue":a[1]||(a[1]=e=>N.table=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:ee},{default:E((()=>[(T(!0),M(F,null,z(V.value,(e=>(T(),I(g,{value:e.table_name},{default:E((()=>[O(H(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),S(P,{field:"package_name",label:e.$t("code.packageName"),"validate-trigger":"blur"},{default:E((()=>[S(K,{modelValue:N.package_name,"onUpdate:modelValue":a[2]||(a[2]=e=>N.package_name=e),placeholder:e.$t("code.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),S(P,null,{default:E((()=>[S(de,null,{default:E((()=>[S(R,{"html-type":"submit",type:"primary",shape:"round"},{default:E((()=>[O(H(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),S(R,{type:"primary",shape:"round",onClick:a[3]||(a[3]=e=>w.value=!0)},{icon:E((()=>[S(ue)])),default:E((()=>[O(" "+H(e.$t("form.addField")),1)])),_:1}),S(ce,{style:{"margin-top":"10px"},stripe:!0,hoverable:!0,columns:Y,data:x.value,pagination:!1},{required:E((({rowIndex:a})=>["join"!=x.value[a].field_type?(T(),I(se,{key:0,modelValue:x.value[a].required,"onUpdate:modelValue":e=>x.value[a].required=e},{default:E((()=>[S(re,{value:1},{default:E((()=>[O(H(e.$t("tableSelect.ok")),1)])),_:1}),S(re,{value:0},{default:E((()=>[O(H(e.$t("tableSelect.no")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):G("",!0)])),is_search:E((({rowIndex:a})=>["join"!=x.value[a].field_type?(T(),I(se,{key:0,modelValue:x.value[a].is_search,"onUpdate:modelValue":e=>x.value[a].is_search=e},{default:E((()=>[S(re,{value:1},{default:E((()=>[O(H(e.$t("tableSelect.ok")),1)])),_:1}),S(re,{value:0},{default:E((()=>[O(H(e.$t("tableSelect.no")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):G("",!0)])),conditions:E((({rowIndex:a})=>[1==x.value[a].is_search?(T(),I(q,{key:0,style:{width:"100px"},modelValue:x.value[a].conditions,"onUpdate:modelValue":e=>x.value[a].conditions=e,placeholder:e.$t("code.select")},{default:E((()=>[(T(),M(F,null,z(ie,(e=>S(g,{value:e},{default:E((()=>[O(H(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):G("",!0)])),option:E((({rowIndex:a})=>["join"==x.value[a].field_type?(T(),I(de,{key:0},{default:E((()=>[S(R,{type:"text",style:{"margin-left":"10px"},shape:"round",size:"mini",onClick:e=>{return l=x.value[a],t=a,W.value={comment:l.comment,field_name:l.field_name,field_type:l.field_type,join_table:l.join_table,join_field:l.join_field,join_type:l.join_type,update_index:t},void(w.value=!0);var l,t}},{icon:E((()=>[S(me)])),default:E((()=>[O(" "+H(e.$t("tableOption.edit")),1)])),_:2},1032,["onClick"]),S(R,{type:"text",status:"danger",shape:"round",size:"mini",onClick:e=>{return l=a,void x.value.splice(l,1);var l}},{icon:E((()=>[S(pe)])),default:E((()=>[O(" "+H(e.$t("tableOption.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)):G("",!0)])),_:1},8,["data"])])),_:1},8,["title"]),S(fe,{visible:w.value,"onUpdate:visible":a[9]||(a[9]=e=>w.value=e),footer:!1,draggable:""},{title:E((()=>a[14]||(a[14]=[O(" 编辑字段 ")]))),default:E((()=>[L("div",null,[S(ne,{model:W.value,rules:Q,onSubmit:U},{default:E((()=>[S(P,{field:"comment",label:e.$t("form2.chinese_name")},{default:E((()=>[S(K,{modelValue:W.value.comment,"onUpdate:modelValue":a[4]||(a[4]=e=>W.value.comment=e)},null,8,["modelValue"])])),_:1},8,["label"]),S(P,{field:"join_type",label:e.$t("form2.join_type"),help:e.$t("form2.help")},{default:E((()=>[S(q,{placeholder:e.$t("code.select"),modelValue:W.value.join_type,"onUpdate:modelValue":a[5]||(a[5]=e=>W.value.join_type=e),"allow-clear":"","allow-search":""},{default:E((()=>[(T(),M(F,null,z(Z,(e=>S(g,{value:e.value},{default:E((()=>[O(H(e.name),1)])),_:2},1032,["value"]))),64))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label","help"]),S(P,{field:"field_name",label:e.$t("form2.field_name")},{default:E((()=>[S(q,{placeholder:e.$t("code.select"),modelValue:W.value.field_name,"onUpdate:modelValue":a[6]||(a[6]=e=>W.value.field_name=e),"allow-clear":"","allow-search":""},{default:E((()=>[(T(!0),M(F,null,z(x.value,(e=>(T(),I(g,{value:e.field_name},{default:E((()=>[O(H(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),S(P,{field:"join_table",label:e.$t("form2.join_table")},{default:E((()=>[S(q,{placeholder:e.$t("code.select"),modelValue:W.value.join_table,"onUpdate:modelValue":a[7]||(a[7]=e=>W.value.join_table=e),"allow-clear":"","allow-search":"",onChange:te},{default:E((()=>[(T(!0),M(F,null,z(V.value,(e=>(T(),I(g,{value:e.table_name},{default:E((()=>[O(H(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),S(P,{field:"join_field",label:e.$t("form2.join_field")},{default:E((()=>[S(q,{placeholder:e.$t("code.select"),modelValue:W.value.join_field,"onUpdate:modelValue":a[8]||(a[8]=e=>W.value.join_field=e),"allow-clear":"","allow-search":""},{default:E((()=>[(T(!0),M(F,null,z(k.value,(e=>(T(),I(g,{value:e.field_name},{default:E((()=>[O(H(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),S(P,null,{default:E((()=>[S(R,{"html-type":"submit",type:"primary",shape:"round"},{default:E((()=>[O(H(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"]),L("div",J,[S(R,{type:"primary",shape:"round",onClick:a[10]||(a[10]=e=>oe(!1))},{icon:E((()=>[S(me)])),default:E((()=>[O(" "+H(e.$t("tableOption.preview")),1)])),_:1}),S(be,{content:B(l)("tips.is_gen_code"),type:"info",onOk:a[11]||(a[11]=e=>oe(!0))},{default:E((()=>[S(R,{type:"primary",style:{"margin-left":"20px"},shape:"round"},{icon:E((()=>[S(ve)])),default:E((()=>[O(" "+H(e.$t("tableOption.gen_code")),1)])),_:1})])),_:1},8,["content"])]),$.value?(T(),I(A,{key:0,visible:$.value,"onUpdate:visible":a[12]||(a[12]=e=>$.value=e),preCode:C.value,"onUpdate:preCode":a[13]||(a[13]=e=>C.value=e)},null,8,["visible","preCode"])):G("",!0)])}}},[["__scopeId","data-v-96e827f0"]]);export{Q as default};
