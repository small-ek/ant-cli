import{b as e,T as a,I as l,B as t,c as d,d as i,C as o,O as n,S as u,F as r,e as s,f as m,g as p,h as _,i as c,j as v,k as f,l as b}from"./@arco-design-CDxg4xoH.js";import{u as h}from"./vue-i18n-KaOKNvmp.js";import{a as y}from"./axios-CzIG8f22.js";import{H as j,g}from"./highlight.js-CrvlJobM.js";import{a as x}from"./clipboard-BEQH_2kK.js";import{_ as V}from"./index-B-OmhvMj.js";import{r as w,o as k,z as q,u as C,h as U,q as I,C as N,y as T,v as E,j as $,O,_ as S,F as z,m as B,a as L,s as M,N as G}from"./@vue-BSNo90qy.js";import"./scroll-into-view-if-needed-Cs7OIxrW.js";import"./compute-scroll-into-view-DCNUDwgY.js";import"./b-validate-Tl0hto4A.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./number-precision-E2hnQMPc.js";import"./@intlify-BYuV0Tqv.js";import"./vue-router-CsF3h0_N.js";import"./nprogress-IEAc2Quw.js";function H(){var e=y.create({baseURL:"http://127.0.0.1:49000/",timeout:15e3,headers:{}});return e.interceptors.request.use((e=>e),(e=>Promise.reject(e))),e.interceptors.response.use((e=>e),(e=>Promise.reject(e))),e}const P=e=>H().request({url:"api/table-field",method:"GET",params:e}),F=["innerHTML"],K=V({__name:"index",props:{visible:{type:Boolean,default:!1},preCode:{type:Object,default:{}}},emits:["update:visible"],setup(o,{emit:n}){const u=w(1);k((()=>{q((()=>{document.querySelectorAll("pre").forEach((e=>{j.highlightElement(e,{language:g,theme:"monokai-sublime"})}))}))}));const r=o;let{visible:s,preCode:m}=C(r);const p=n,_=()=>{p("update:visible",!1)},c=()=>{x.copy(m.value[u.value-1].code),e.info({content:"复制成功",duration:2e3,id:"copy2"})},v=a=>{x.copy(m.value[a-1].code),e.info({content:"已复制",duration:2e3,id:"copy"})};return(e,o)=>{const n=i,r=a,p=l,f=t,b=d;return U(),I(b,{width:800,visible:S(s),onCancel:_,footer:!1,draggable:""},{title:N((()=>[T(" 预览代码 ")])),default:N((()=>[E(r,{"active-key":u.value,"onUpdate:activeKey":o[0]||(o[0]=e=>u.value=e),onChange:v},{default:N((()=>[(U(!0),$(z,null,O(S(m),((e,a)=>(U(),I(n,{key:a+1,title:e.name},{default:N((()=>[B("pre",null,[B("code",{class:"language-code",innerHTML:e.code},null,8,F)])])),_:2},1032,["title"])))),128))])),_:1},8,["active-key"]),B("div",null,[E(f,{type:"primary",style:{float:"right"},onClick:c},{icon:N((()=>[E(p)])),default:N((()=>[T(" 复制 ")])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-74db95be"]]),W={class:"container"},A={style:{"margin-top":"15px"}},R=V({__name:"index",setup(a){const{t:l}=h(),i=w([]),y=w([]),j=w([]),g=w([]),x=w(!1),V=w(!1),k=w({}),q=({values:e,errors:a})=>{void 0===a&&(0==S.value.update_index?j.value.push({comment:S.value.comment,field_name:S.value.field_name,field_type:"join",join_type:S.value.join_type,join_table:S.value.join_table,join_field:S.value.join_field,required:0,is_search:0,conditions:""}):j.value[S.value.update_index]={comment:S.value.comment,field_name:S.value.field_name,field_type:"join",join_type:S.value.join_type,join_table:S.value.join_table,join_field:S.value.join_field,required:0,is_search:0,conditions:""},x.value=!1)},C=L({dbname:"",table:"",package_name:"index",table_comment:""}),S=w({comment:"",field_name:"",field_type:"",join_table:"",join_field:"",join_type:"",update_index:0}),F={comment:[{required:!0,message:l("verify.databaseName")}],join_type:[{required:!0,message:"请选择关联类型"}],field_name:[{required:!0,message:"请选择当前表字段"}],join_table:[{required:!0,message:"请选择关联表"}],join_field:[{required:!0,message:"请选择关联表字段"}]},R={dbname:[{required:!0,message:l("verify.databaseName")}],table:[{required:!0,message:l("verify.tableName")}]},D=[{title:"中文名称",dataIndex:"comment",ellipsis:!0,tooltip:!0,width:150},{title:"数据库类型",dataIndex:"field_type",ellipsis:!0,tooltip:!0,width:120},{title:"数据库字段名称",dataIndex:"field_name",ellipsis:!0,tooltip:!0,width:180},{title:"是否必填",dataIndex:"required",slotName:"required",width:150},{title:"是否搜索",dataIndex:"is_search",slotName:"is_search",width:150},{title:"查询条件",dataIndex:"conditions",slotName:"conditions",width:150},{title:"操作",dataIndex:"option",slotName:"option",width:180}],J=[{name:"一对一",value:"oneToOne"},{name:"一对多",value:"oneToMany"},{name:"多对多",value:"manyToMany"}];H().request({url:"api/database",method:"GET"}).then((e=>{i.value=e.data}));const Q=e=>{y.value.forEach((a=>{a.table_name==e&&(C.table_comment=a.table_comment)}))},X=()=>{var e;(e={table:C.dbname},H().request({url:"api/table-list",method:"GET",params:e})).then((e=>{y.value=e.data}))},Y=({values:e,errors:a})=>{void 0===a&&P({db:C.dbname,table:C.table}).then((e=>{const a=[];for(let l=0;l<e.data.length;l++)a.push({comment:e.data[l].comment,field_name:e.data[l].field_name,field_type:e.data[l].field_type,indexes:e.data[l].indexes,required:0,is_search:0});j.value=a}))},Z=()=>{P({db:C.dbname,table:S.value.join_table}).then((e=>{g.value=e.data}))},ee=a=>{var l;(l={table_name:C.table,fields:j.value,package:C.package_name,is_create:a,data_base:C.dbname,table_comment:C.table_comment},H().request({url:"api/code",method:"POST",data:l})).then((l=>{0==a?V.value=!0:e.info("生成成功"),k.value=l.data}))},ae=["=","!=","<",">","<=",">=","LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN"];return(e,a)=>{const l=n,h=u,w=r,L=s,H=t,P=m,le=p,te=_,de=c,ie=v,oe=f,ne=o,ue=d,re=b;return U(),$("div",W,[E(ne,{style:{width:"1000px",marginTop:"50px"},title:e.$t("code.generation"),hoverable:""},{default:N((()=>[E(le,{rules:R,model:C,style:{width:"600px"},onSubmit:Y},{default:N((()=>[E(w,{field:"dbname",label:e.$t("code.databaseName"),"validate-trigger":"blur"},{default:N((()=>[E(h,{modelValue:C.dbname,"onUpdate:modelValue":a[0]||(a[0]=e=>C.dbname=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:X},{default:N((()=>[(U(!0),$(z,null,O(i.value,(e=>(U(),I(l,{value:e},{default:N((()=>[T(G(e),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),E(w,{field:"table",label:e.$t("code.tableName"),"validate-trigger":"blur"},{default:N((()=>[E(h,{modelValue:C.table,"onUpdate:modelValue":a[1]||(a[1]=e=>C.table=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:Q},{default:N((()=>[(U(!0),$(z,null,O(y.value,(e=>(U(),I(l,{value:e.table_name},{default:N((()=>[T(G(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),E(w,{field:"package_name",label:e.$t("code.packageName"),"validate-trigger":"blur"},{default:N((()=>[E(L,{modelValue:C.package_name,"onUpdate:modelValue":a[2]||(a[2]=e=>C.package_name=e),placeholder:"请输入包名"},null,8,["modelValue"])])),_:1},8,["label"]),E(w,null,{default:N((()=>[E(P,null,{default:N((()=>[E(H,{"html-type":"submit",type:"primary",shape:"round"},{default:N((()=>[T(G(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),E(H,{type:"primary",shape:"round",onClick:a[3]||(a[3]=e=>x.value=!0)},{icon:N((()=>[E(te)])),default:N((()=>[T(" 新建关联表 ")])),_:1}),E(oe,{style:{"margin-top":"10px"},columns:D,data:j.value,pagination:!1},{required:N((({rowIndex:e})=>["join"!=j.value[e].field_type?(U(),I(h,{key:0,style:{width:"100px"},modelValue:j.value[e].required,"onUpdate:modelValue":a=>j.value[e].required=a,placeholder:"请选择"},{default:N((()=>[E(l,{value:1},{default:N((()=>[T("是")])),_:1}),E(l,{value:0},{default:N((()=>[T("否")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0)])),is_search:N((({rowIndex:e})=>["join"!=j.value[e].field_type?(U(),I(h,{key:0,style:{width:"100px"},modelValue:j.value[e].is_search,"onUpdate:modelValue":a=>j.value[e].is_search=a,placeholder:"请选择"},{default:N((()=>[E(l,{value:1},{default:N((()=>[T("是")])),_:1}),E(l,{value:0},{default:N((()=>[T("否")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0)])),conditions:N((({rowIndex:e})=>[1==j.value[e].is_search?(U(),I(h,{key:0,style:{width:"100px"},modelValue:j.value[e].conditions,"onUpdate:modelValue":a=>j.value[e].conditions=a,placeholder:"请选择"},{default:N((()=>[(U(),$(z,null,O(ae,(e=>E(l,{value:e},{default:N((()=>[T(G(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"])):M("",!0)])),option:N((({rowIndex:e})=>["join"==j.value[e].field_type?(U(),I(P,{key:0},{default:N((()=>[E(H,{type:"text",style:{"margin-left":"10px"},shape:"round",size:"mini",onClick:a=>{return l=j.value[e],t=e,S.value={comment:l.comment,field_name:l.field_name,field_type:l.field_type,join_table:l.join_table,join_field:l.join_field,join_type:l.join_type,update_index:t},void(x.value=!0);var l,t}},{icon:N((()=>[E(de)])),default:N((()=>[T(" 编辑 ")])),_:2},1032,["onClick"]),E(H,{type:"text",status:"danger",style:{"margin-left":"10px"},shape:"round",size:"mini",onClick:a=>{return l=e,void j.value.splice(l,1);var l}},{icon:N((()=>[E(ie)])),default:N((()=>[T(" 删除 ")])),_:2},1032,["onClick"])])),_:2},1024)):M("",!0)])),_:1},8,["data"])])),_:1},8,["title"]),E(ue,{visible:x.value,"onUpdate:visible":a[9]||(a[9]=e=>x.value=e),footer:!1,draggable:""},{title:N((()=>[T(" 编辑字段 ")])),default:N((()=>[B("div",null,[E(le,{model:S.value,rules:F,onSubmit:q},{default:N((()=>[E(w,{field:"comment",label:"中文名称"},{default:N((()=>[E(L,{modelValue:S.value.comment,"onUpdate:modelValue":a[4]||(a[4]=e=>S.value.comment=e)},null,8,["modelValue"])])),_:1}),E(w,{field:"join_type",label:"关联模型",help:"多对多模型,中间表要求表名+字段名称拼接，必须驼峰命名,例如(user_refer_id)，user_refer是表名称"},{default:N((()=>[E(h,{placeholder:"请选择",modelValue:S.value.join_type,"onUpdate:modelValue":a[5]||(a[5]=e=>S.value.join_type=e),"allow-clear":"","allow-search":""},{default:N((()=>[(U(),$(z,null,O(J,(e=>E(l,{value:e.value},{default:N((()=>[T(G(e.name),1)])),_:2},1032,["value"]))),64))])),_:1},8,["modelValue"])])),_:1}),E(w,{field:"field_name",label:"当前表字段"},{default:N((()=>[E(h,{placeholder:"请选择",modelValue:S.value.field_name,"onUpdate:modelValue":a[6]||(a[6]=e=>S.value.field_name=e),"allow-clear":"","allow-search":""},{default:N((()=>[(U(!0),$(z,null,O(j.value,(e=>(U(),I(l,{value:e.field_name},{default:N((()=>[T(G(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1}),E(w,{field:"join_table",label:"关联表"},{default:N((()=>[E(h,{placeholder:"请选择",modelValue:S.value.join_table,"onUpdate:modelValue":a[7]||(a[7]=e=>S.value.join_table=e),"allow-clear":"","allow-search":"",onChange:Z},{default:N((()=>[(U(!0),$(z,null,O(y.value,(e=>(U(),I(l,{value:e.table_name},{default:N((()=>[T(G(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1}),E(w,{field:"join_field",label:"关联表字段"},{default:N((()=>[E(h,{placeholder:"请选择",modelValue:S.value.join_field,"onUpdate:modelValue":a[8]||(a[8]=e=>S.value.join_field=e),"allow-clear":"","allow-search":""},{default:N((()=>[(U(!0),$(z,null,O(g.value,(e=>(U(),I(l,{value:e.field_name},{default:N((()=>[T(G(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue"])])),_:1}),E(w,null,{default:N((()=>[E(H,{"html-type":"submit",type:"primary",shape:"round"},{default:N((()=>[T(G(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"]),B("div",A,[E(H,{type:"primary",shape:"round",onClick:a[10]||(a[10]=e=>ee(!1))},{icon:N((()=>[E(de)])),default:N((()=>[T(" 预览代码 ")])),_:1}),E(H,{type:"primary",style:{"margin-left":"20px"},shape:"round",onClick:a[11]||(a[11]=e=>ee(!0))},{icon:N((()=>[E(re)])),default:N((()=>[T(" 生成代码 ")])),_:1})]),V.value?(U(),I(K,{key:0,visible:V.value,"onUpdate:visible":a[12]||(a[12]=e=>V.value=e),preCode:k.value,"onUpdate:preCode":a[13]||(a[13]=e=>k.value=e)},null,8,["visible","preCode"])):M("",!0)])}}},[["__scopeId","data-v-155ec641"]]);export{R as default};
