var t=Object.prototype.toString;function e(e){return"[object Array]"===t.call(e)}function i(e){return"[object Object]"===t.call(e)}function n(e){return"[object String]"===t.call(e)}function s(e){return"[object Function]"===t.call(e)}function r(t){return null==t||""===t}function a(t){return e(t)&&!t.length}var o=function(t,e){if("object"!=typeof t||"object"!=typeof e)return t===e;if(s(t)&&s(e))return t===e||t.toString()===e.toString();if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t){if(!o(t[i],e[i]))return!1}return!0},h=function(t,e){var n=Object.assign({},t);return Object.keys(e||{}).forEach((function(t){var s=n[t],r=null==e?void 0:e[t];n[t]=i(s)?Object.assign(Object.assign({},s),r):r||s})),n},l="#{field} is not a #{type} type",u={required:"#{field} is required",type:{ip:l,email:l,url:l,string:l,number:l,array:l,object:l,boolean:l},number:{min:"`#{value}` is not greater than `#{min}`",max:"`#{value}` is not less than `#{max}`",equal:"`#{value}` is not equal to `#{equal}`",range:"`#{value}` is not in range `#{min} ~ #{max}`",positive:"`#{value}` is not a positive number",negative:"`#{value}` is not a negative number"},string:{maxLength:"#{field} cannot be longer than #{maxLength} characters",minLength:"#{field} must be at least #{minLength} characters",length:"#{field} must be exactly #{length} characters",match:"`#{value}` does not match pattern #{pattern}",uppercase:"`#{value}` must be all uppercase",lowercase:"`#{value}` must be all lowercased"},array:{length:"#{field} must be exactly #{length} in length",minLength:"#{field} cannot be less than #{minLength} in length",maxLength:"#{field} cannot be greater than #{maxLength} in length",includes:"#{field} is not includes #{includes}",deepEqual:"#{field} is not deep equal with #{deepEqual}",empty:"#{field} is not an empty array"},object:{deepEqual:"#{field} is not deep equal to expected value",hasKeys:"#{field} does not contain required fields",empty:"#{field} is not an empty object"},boolean:{true:"Expect true but got `#{value}`",false:"Expect false but got `#{value}`"}},c=function(t,r){var a=this;this.getValidateMsg=function(t,r){void 0===r&&(r={});var o=Object.assign(Object.assign({},r),{value:a.obj,field:a.field,type:a.type}),h=function(t,e){for(var i=e.split("."),n=t,s=0;s<i.length;s++)if(void 0===(n=n&&n[i[s]]))return n;return n}(a.validateMessages,t);return s(h)?h(o):n(h)?h.replace(/\#\{.+?\}/g,(function(t){var n=t.slice(2,-1);if(n in o){if(i(o[n])||e(o[n]))try{return JSON.stringify(o[n])}catch(s){return o[n]}return String(o[n])}return t})):h},i(r)&&n(t)&&r.trim?this.obj=t.trim():i(r)&&r.ignoreEmptyString&&""===t?this.obj=void 0:this.obj=t,this.message=r.message,this.type=r.type,this.error=null,this.field=r.field||r.type,this.validateMessages=h(u,r.validateMessages)},g={not:{configurable:!0},isRequired:{configurable:!0},end:{configurable:!0}};g.not.get=function(){return this._not=!this._not,this},g.isRequired.get=function(){if(r(this.obj)||a(this.obj)){var t=this.getValidateMsg("required");this.error={value:this.obj,type:this.type,requiredError:!0,message:this.message||(i(t)?t:(this._not?"[NOT MODE]:":"")+t)}}return this},g.end.get=function(){return this.error},c.prototype.addError=function(t){!this.error&&t&&(this.error={value:this.obj,type:this.type,message:this.message||(i(t)?t:(this._not?"[NOT MODE]:":"")+t)})},c.prototype.validate=function(t,e){return(this._not?t:!t)&&this.addError(e),this},c.prototype.collect=function(t){t&&t(this.error)},Object.defineProperties(c.prototype,g);var p=function(t){function e(e,i){t.call(this,e,Object.assign(Object.assign({},i),{type:"string"})),this.validate(!i||!i.strict||n(this.obj),this.getValidateMsg("type.string"))}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={uppercase:{configurable:!0},lowercase:{configurable:!0}};return e.prototype.maxLength=function(t){return this.obj?this.validate(this.obj.length<=t,this.getValidateMsg("string.maxLength",{maxLength:t})):this},e.prototype.minLength=function(t){return this.obj?this.validate(this.obj.length>=t,this.getValidateMsg("string.minLength",{minLength:t})):this},e.prototype.length=function(t){return this.obj?this.validate(this.obj.length===t,this.getValidateMsg("string.length",{length:t})):this},e.prototype.match=function(t){var e=t instanceof RegExp;return e&&(t.lastIndex=0),this.validate(void 0===this.obj||e&&t.test(this.obj),this.getValidateMsg("string.match",{pattern:t}))},i.uppercase.get=function(){return this.obj?this.validate(this.obj.toUpperCase()===this.obj,this.getValidateMsg("string.uppercase")):this},i.lowercase.get=function(){return this.obj?this.validate(this.obj.toLowerCase()===this.obj,this.getValidateMsg("string.lowercase")):this},Object.defineProperties(e.prototype,i),e}(c),b=function(e){function i(i,n){e.call(this,i,Object.assign(Object.assign({},n),{type:"number"})),this.validate(!n||!n.strict||function(e){return"[object Number]"===t.call(e)&&e==e}(this.obj),this.getValidateMsg("type.number"))}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var n={positive:{configurable:!0},negative:{configurable:!0}};return i.prototype.min=function(t){return r(this.obj)?this:this.validate(this.obj>=t,this.getValidateMsg("number.min",{min:t}))},i.prototype.max=function(t){return r(this.obj)?this:this.validate(this.obj<=t,this.getValidateMsg("number.max",{max:t}))},i.prototype.equal=function(t){return r(this.obj)?this:this.validate(this.obj===t,this.getValidateMsg("number.equal",{equal:t}))},i.prototype.range=function(t,e){return r(this.obj)?this:this.validate(this.obj>=t&&this.obj<=e,this.getValidateMsg("number.range",{min:t,max:e}))},n.positive.get=function(){return r(this.obj)?this:this.validate(this.obj>0,this.getValidateMsg("number.positive"))},n.negative.get=function(){return r(this.obj)?this:this.validate(this.obj<0,this.getValidateMsg("number.negative"))},Object.defineProperties(i.prototype,n),i}(c),f=function(t){function i(i,n){t.call(this,i,Object.assign(Object.assign({},n),{type:"array"})),this.validate(!n||!n.strict||e(this.obj),this.getValidateMsg("type.array",{value:this.obj,type:this.type}))}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var n={empty:{configurable:!0}};return i.prototype.length=function(t){return this.obj?this.validate(this.obj.length===t,this.getValidateMsg("array.length",{value:this.obj,length:t})):this},i.prototype.minLength=function(t){return this.obj?this.validate(this.obj.length>=t,this.getValidateMsg("array.minLength",{value:this.obj,minLength:t})):this},i.prototype.maxLength=function(t){return this.obj?this.validate(this.obj.length<=t,this.getValidateMsg("array.maxLength",{value:this.obj,maxLength:t})):this},i.prototype.includes=function(t){var e=this;return this.obj?this.validate(t.every((function(t){return-1!==e.obj.indexOf(t)})),this.getValidateMsg("array.includes",{value:this.obj,includes:t})):this},i.prototype.deepEqual=function(t){return this.obj?this.validate(o(this.obj,t),this.getValidateMsg("array.deepEqual",{value:this.obj,deepEqual:t})):this},n.empty.get=function(){return this.validate(a(this.obj),this.getValidateMsg("array.empty",{value:this.obj}))},Object.defineProperties(i.prototype,n),i}(c),d=function(t){function e(e,n){t.call(this,e,Object.assign(Object.assign({},n),{type:"object"})),this.validate(!n||!n.strict||i(this.obj),this.getValidateMsg("type.object"))}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={empty:{configurable:!0}};return e.prototype.deepEqual=function(t){return this.obj?this.validate(o(this.obj,t),this.getValidateMsg("object.deepEqual",{deepEqual:t})):this},e.prototype.hasKeys=function(t){var e=this;return this.obj?this.validate(t.every((function(t){return e.obj[t]})),this.getValidateMsg("object.hasKeys",{keys:t})):this},n.empty.get=function(){return this.validate(i(t=this.obj)&&0===Object.keys(t).length,this.getValidateMsg("object.empty"));var t},Object.defineProperties(e.prototype,n),e}(c),j=function(e){function i(i,n){e.call(this,i,Object.assign(Object.assign({},n),{type:"boolean"})),this.validate(!n||!n.strict||function(e){return"[object Boolean]"===t.call(e)}(this.obj),this.getValidateMsg("type.boolean"))}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var n={true:{configurable:!0},false:{configurable:!0}};return n.true.get=function(){return this.validate(!0===this.obj,this.getValidateMsg("boolean.true"))},n.false.get=function(){return this.validate(!1===this.obj,this.getValidateMsg("boolean.false"))},Object.defineProperties(i.prototype,n),i}(c),y=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,v=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),m=/^(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})(\.(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})){3}$/,O=function(t){function e(e,i){t.call(this,e,Object.assign(Object.assign({},i),{type:"type"}))}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={email:{configurable:!0},url:{configurable:!0},ip:{configurable:!0}};return i.email.get=function(){return this.type="email",this.validate(void 0===this.obj||y.test(this.obj),this.getValidateMsg("type.email"))},i.url.get=function(){return this.type="url",this.validate(void 0===this.obj||v.test(this.obj),this.getValidateMsg("type.url"))},i.ip.get=function(){return this.type="ip",this.validate(void 0===this.obj||m.test(this.obj),this.getValidateMsg("type.ip"))},Object.defineProperties(e.prototype,i),e}(c),M=function(t){function e(e,i){t.call(this,e,Object.assign(Object.assign({},i),{type:"custom"}))}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={validate:{configurable:!0}};return i.validate.get=function(){var t=this;return function(e,i){var n;if(e)return(n=e(t.obj,t.addError.bind(t)))&&n.then?(i&&n.then((function(){i&&i(t.error)}),(function(t){})),[n,t]):(i&&i(t.error),t.error)}},Object.defineProperties(e.prototype,i),e}(c),_=function(t,e){return new V(t,Object.assign({field:"value"},e))};_.globalConfig={},_.setGlobalConfig=function(t){_.globalConfig=t||{}};var V=function(t,e){var i=_.globalConfig,n=Object.assign(Object.assign(Object.assign({},i),e),{validateMessages:h(i.validateMessages,e.validateMessages)});this.string=new p(t,n),this.number=new b(t,n),this.array=new f(t,n),this.object=new d(t,n),this.boolean=new j(t,n),this.type=new O(t,n),this.custom=new M(t,n)},E=function(t,e){void 0===e&&(e={}),this.schema=t,this.options=e};E.prototype.messages=function(t){this.options=Object.assign(Object.assign({},this.options),{validateMessages:h(this.options.validateMessages,t)})},E.prototype.validate=function(t,n){var s=this;if(i(t)){var r=[],a=null;this.schema&&Object.keys(this.schema).forEach((function(i){if(e(s.schema[i]))for(var n=function(e){var n=s.schema[i][e],h=n.type,l=n.message;if(!h&&!n.validator)throw"You must specify a type to field "+i+"!";var u=Object.assign(Object.assign({},s.options),{message:l,field:i});"ignoreEmptyString"in n&&(u.ignoreEmptyString=n.ignoreEmptyString),"strict"in n&&(u.strict=n.strict);var c=new V(t[i],u),g=c.type[h]||null;if(!g){if(n.validator)return g=c.custom.validate(n.validator),void("[object Array]"===Object.prototype.toString.call(g)&&g[0].then?r.push({function:g[0],_this:g[1],key:i}):g&&o(i,g));g=c[h]}if(Object.keys(n).forEach((function(t){n.required&&(g=g.isRequired),"message"!==t&&g[t]&&n[t]&&"object"==typeof g[t]&&(g=g[t]),g[t]&&void 0!==n[t]&&"function"==typeof g[t]&&(g=g[t](n[t]))})),g.collect((function(t){t&&o(i,t)})),a)return"break"},h=0;h<s.schema[i].length;h++){if("break"===n(h))break}})),r.length>0?Promise.all(r.map((function(t){return t.function}))).then((function(){r.forEach((function(t){t._this.error&&o(t.key,t._this.error)})),n&&n(a)})):n&&n(a)}function o(t,e){a||(a={}),a[t]&&!e.requiredError||(a[t]=e)}};export{E as S};
