import{c as e,d as a,e as l,B as t,f as o,g as i,C as d,S as n,F as u,h as r,i as s,j as m,k as p,R as c,l as _,m as f,n as v,o as b,p as h,O as y}from"./@arco-design-DhjZBQIv.js";import{u as j}from"./vue-i18n-KaOKNvmp.js";import{a as g}from"./axios-CzIG8f22.js";import{H as V,g as x}from"./highlight.js-CrvlJobM.js";import{a as w}from"./clipboard-BEQH_2kK.js";import{_ as k}from"./index-DRseuRNB.js";import{r as $,o as q,z as C,u as U,h as N,q as T,C as I,y as E,v as O,j as M,O as S,_ as z,F as B,m as L,a as F,s as G,N as H}from"./@vue-BSNo90qy.js";import"./scroll-into-view-if-needed-Cs7OIxrW.js";import"./compute-scroll-into-view-DCNUDwgY.js";import"./b-validate-Tl0hto4A.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./number-precision-E2hnQMPc.js";import"./@intlify-BYuV0Tqv.js";import"./vue-router-CsF3h0_N.js";import"./nprogress-IEAc2Quw.js";function P(){var e=g.create({baseURL:"http://127.0.0.1:49000/",timeout:15e3,headers:{}});return e.interceptors.request.use((e=>e),(e=>Promise.reject(e))),e.interceptors.response.use((e=>e),(e=>Promise.reject(e))),e}const K=e=>P().request({url:"api/table-field",method:"GET",params:e}),R=["innerHTML"],W=k({__name:"index",props:{visible:{type:Boolean,default:!1},preCode:{type:Object,default:{}}},emits:["update:visible"],setup(d,{emit:n}){const u=$(1);q((()=>{C((()=>{document.querySelectorAll("pre").forEach((e=>{V.highlightElement(e,{language:x,theme:"monokai-sublime"})}))}))}));const r=d;let{visible:s,preCode:m}=U(r);const p=n,c=()=>{p("update:visible",!1)},_=()=>{w.copy(m.value[u.value-1].code),e.info({content:"复制成功",duration:2e3,id:"copy2"})},f=a=>{w.copy(m.value[a-1].code),e.info({content:"已复制",duration:2e3,id:"copy"})};return(e,d)=>{const n=i,r=a,p=l,v=t,b=o;return N(),T(b,{width:800,visible:z(s),onCancel:c,footer:!1,draggable:""},{title:I((()=>[E(" 预览代码 ")])),default:I((()=>[O(r,{"active-key":u.value,"onUpdate:activeKey":d[0]||(d[0]=e=>u.value=e),onChange:f},{default:I((()=>[(N(!0),M(B,null,S(z(m),((e,a)=>(N(),T(n,{key:a+1,title:e.name},{default:I((()=>[L("pre",null,[L("code",{class:"language-code",innerHTML:e.code},null,8,R)])])),_:2},1032,["title"])))),128))])),_:1},8,["active-key"]),L("div",null,[O(v,{type:"primary",style:{float:"right"},onClick:_},{icon:I((()=>[O(p)])),default:I((()=>[E(" 复制 ")])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-74db95be"]]),A={class:"container"},D={style:{"margin-top":"15px"}},J=k({__name:"index",setup(a){const{t:l}=j(),i=$([]),g=$([]),V=$([]),x=$([]),w=$(!1),k=$(!1),q=$({}),C=({values:e,errors:a})=>{void 0===a&&(0==z.value.update_index?V.value.push({comment:z.value.comment,field_name:z.value.field_name,field_type:"join",join_type:z.value.join_type,join_table:z.value.join_table,join_field:z.value.join_field,required:0,is_search:0,conditions:""}):V.value[z.value.update_index]={comment:z.value.comment,field_name:z.value.field_name,field_type:"join",join_type:z.value.join_type,join_table:z.value.join_table,join_field:z.value.join_field,required:0,is_search:0,conditions:""},w.value=!1)},U=F({dbname:"",table:"",package_name:"api",table_comment:""}),z=$({comment:"",field_name:"",field_type:"",join_table:"",join_field:"",join_type:"",update_index:0}),R={comment:[{required:!0,message:l("verify.comment")}],join_type:[{required:!0,message:l("verify.join_type")}],field_name:[{required:!0,message:l("verify.field_name")}],join_table:[{required:!0,message:l("verify.join_table")}],join_field:[{required:!0,message:l("verify.join_field")}]},J={dbname:[{required:!0,message:l("verify.databaseName")}],table:[{required:!0,message:l("verify.tableName")}],package_name:[{required:!0,message:l("verify.packageName")}]},Q=[{title:l("table_columns.comment"),dataIndex:"comment",ellipsis:!0,tooltip:!0,width:140},{title:l("table_columns.field_type"),dataIndex:"field_type",ellipsis:!0,tooltip:!0,width:100},{title:l("table_columns.field_name"),dataIndex:"field_name",ellipsis:!0,tooltip:!0,width:130},{title:l("table_columns.required"),dataIndex:"required",slotName:"required",width:155},{title:l("table_columns.is_search"),dataIndex:"is_search",slotName:"is_search",width:155},{title:l("table_columns.conditions"),dataIndex:"conditions",slotName:"conditions",width:130},{title:l("table_columns.option"),dataIndex:"option",slotName:"option",width:160}],X=[{name:l("correlationModel.oneToOne"),value:"oneToOne"},{name:l("correlationModel.oneToMany"),value:"oneToMany"},{name:l("correlationModel.manyToMany"),value:"manyToMany"}];P().request({url:"api/database",method:"GET"}).then((e=>{i.value=e.data}));const Y=e=>{g.value.forEach((a=>{a.table_name==e&&(U.table_comment=a.table_comment)}))},Z=()=>{var e;(e={table:U.dbname},P().request({url:"api/table-list",method:"GET",params:e})).then((e=>{g.value=e.data}))},ee=({values:e,errors:a})=>{void 0===a&&K({db:U.dbname,table:U.table}).then((e=>{const a=[];for(let l=0;l<e.data.length;l++)a.push({comment:e.data[l].comment,field_name:e.data[l].field_name,field_type:e.data[l].field_type,indexes:e.data[l].indexes,required:0,is_search:0});V.value=a}))},ae=()=>{K({db:U.dbname,table:z.value.join_table}).then((e=>{x.value=e.data}))},le=a=>{var t;(t={table_name:U.table,fields:V.value,package:U.package_name,is_create:a,data_base:U.dbname,table_comment:U.table_comment},P().request({url:"api/code",method:"POST",data:t})).then((t=>{0==a?k.value=!0:e.info(l("tips.success")),q.value=t.data}))},te=["=","!=","<",">","<=",">=","LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN"];return(e,a)=>{const l=y,j=n,$=u,F=r,P=t,K=s,oe=m,ie=p,de=c,ne=_,ue=f,re=v,se=b,me=d,pe=o,ce=h;return N(),M("div",A,[O(me,{style:{width:"1000px",marginTop:"50px"},title:e.$t("code.generation"),hoverable:""},{default:I((()=>[O(oe,{rules:J,model:U,style:{width:"850px"},onSubmit:ee},{default:I((()=>[O($,{field:"dbname",label:e.$t("code.databaseName"),"validate-trigger":"blur"},{default:I((()=>[O(j,{modelValue:U.dbname,"onUpdate:modelValue":a[0]||(a[0]=e=>U.dbname=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:Z},{default:I((()=>[(N(!0),M(B,null,S(i.value,(e=>(N(),T(l,{value:e},{default:I((()=>[E(H(e),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),O($,{field:"table",label:e.$t("code.tableName"),"validate-trigger":"blur"},{default:I((()=>[O(j,{modelValue:U.table,"onUpdate:modelValue":a[1]||(a[1]=e=>U.table=e),placeholder:e.$t("code.select"),"allow-clear":"","allow-search":"",onChange:Y},{default:I((()=>[(N(!0),M(B,null,S(g.value,(e=>(N(),T(l,{value:e.table_name},{default:I((()=>[E(H(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),O($,{field:"package_name",label:e.$t("code.packageName"),"validate-trigger":"blur"},{default:I((()=>[O(F,{modelValue:U.package_name,"onUpdate:modelValue":a[2]||(a[2]=e=>U.package_name=e),placeholder:e.$t("code.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),O($,null,{default:I((()=>[O(K,null,{default:I((()=>[O(P,{"html-type":"submit",type:"primary",shape:"round"},{default:I((()=>[E(H(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),O(P,{type:"primary",shape:"round",onClick:a[3]||(a[3]=e=>w.value=!0)},{icon:I((()=>[O(ie)])),default:I((()=>[E(" "+H(e.$t("form.addField")),1)])),_:1}),O(se,{style:{"margin-top":"10px"},stripe:!0,hoverable:!0,columns:Q,data:V.value,pagination:!1},{required:I((({rowIndex:a})=>["join"!=V.value[a].field_type?(N(),T(ne,{key:0,modelValue:V.value[a].required,"onUpdate:modelValue":e=>V.value[a].required=e},{default:I((()=>[O(de,{value:1},{default:I((()=>[E(H(e.$t("tableSelect.ok")),1)])),_:1}),O(de,{value:0},{default:I((()=>[E(H(e.$t("tableSelect.no")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):G("",!0)])),is_search:I((({rowIndex:a})=>["join"!=V.value[a].field_type?(N(),T(ne,{key:0,modelValue:V.value[a].is_search,"onUpdate:modelValue":e=>V.value[a].is_search=e},{default:I((()=>[O(de,{value:1},{default:I((()=>[E(H(e.$t("tableSelect.ok")),1)])),_:1}),O(de,{value:0},{default:I((()=>[E(H(e.$t("tableSelect.no")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):G("",!0)])),conditions:I((({rowIndex:a})=>[1==V.value[a].is_search?(N(),T(j,{key:0,style:{width:"100px"},modelValue:V.value[a].conditions,"onUpdate:modelValue":e=>V.value[a].conditions=e,placeholder:e.$t("code.select")},{default:I((()=>[(N(),M(B,null,S(te,(e=>O(l,{value:e},{default:I((()=>[E(H(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):G("",!0)])),option:I((({rowIndex:a})=>["join"==V.value[a].field_type?(N(),T(K,{key:0},{default:I((()=>[O(P,{type:"text",style:{"margin-left":"10px"},shape:"round",size:"mini",onClick:e=>{return l=V.value[a],t=a,z.value={comment:l.comment,field_name:l.field_name,field_type:l.field_type,join_table:l.join_table,join_field:l.join_field,join_type:l.join_type,update_index:t},void(w.value=!0);var l,t}},{icon:I((()=>[O(ue)])),default:I((()=>[E(" "+H(e.$t("tableOption.edit")),1)])),_:2},1032,["onClick"]),O(P,{type:"text",status:"danger",shape:"round",size:"mini",onClick:e=>{return l=a,void V.value.splice(l,1);var l}},{icon:I((()=>[O(re)])),default:I((()=>[E(" "+H(e.$t("tableOption.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)):G("",!0)])),_:1},8,["data"])])),_:1},8,["title"]),O(pe,{visible:w.value,"onUpdate:visible":a[9]||(a[9]=e=>w.value=e),footer:!1,draggable:""},{title:I((()=>[E(" 编辑字段 ")])),default:I((()=>[L("div",null,[O(oe,{model:z.value,rules:R,onSubmit:C},{default:I((()=>[O($,{field:"comment",label:e.$t("form2.chinese_name")},{default:I((()=>[O(F,{modelValue:z.value.comment,"onUpdate:modelValue":a[4]||(a[4]=e=>z.value.comment=e)},null,8,["modelValue"])])),_:1},8,["label"]),O($,{field:"join_type",label:e.$t("form2.join_type"),help:e.$t("form2.help")},{default:I((()=>[O(j,{placeholder:e.$t("code.select"),modelValue:z.value.join_type,"onUpdate:modelValue":a[5]||(a[5]=e=>z.value.join_type=e),"allow-clear":"","allow-search":""},{default:I((()=>[(N(),M(B,null,S(X,(e=>O(l,{value:e.value},{default:I((()=>[E(H(e.name),1)])),_:2},1032,["value"]))),64))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label","help"]),O($,{field:"field_name",label:e.$t("form2.field_name")},{default:I((()=>[O(j,{placeholder:e.$t("code.select"),modelValue:z.value.field_name,"onUpdate:modelValue":a[6]||(a[6]=e=>z.value.field_name=e),"allow-clear":"","allow-search":""},{default:I((()=>[(N(!0),M(B,null,S(V.value,(e=>(N(),T(l,{value:e.field_name},{default:I((()=>[E(H(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),O($,{field:"join_table",label:e.$t("form2.join_table")},{default:I((()=>[O(j,{placeholder:e.$t("code.select"),modelValue:z.value.join_table,"onUpdate:modelValue":a[7]||(a[7]=e=>z.value.join_table=e),"allow-clear":"","allow-search":"",onChange:ae},{default:I((()=>[(N(!0),M(B,null,S(g.value,(e=>(N(),T(l,{value:e.table_name},{default:I((()=>[E(H(e.table_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),O($,{field:"join_field",label:e.$t("form2.join_field")},{default:I((()=>[O(j,{placeholder:e.$t("code.select"),modelValue:z.value.join_field,"onUpdate:modelValue":a[8]||(a[8]=e=>z.value.join_field=e),"allow-clear":"","allow-search":""},{default:I((()=>[(N(!0),M(B,null,S(x.value,(e=>(N(),T(l,{value:e.field_name},{default:I((()=>[E(H(e.field_name),1)])),_:2},1032,["value"])))),256))])),_:1},8,["placeholder","modelValue"])])),_:1},8,["label"]),O($,null,{default:I((()=>[O(P,{"html-type":"submit",type:"primary",shape:"round"},{default:I((()=>[E(H(e.$t("code.verify")),1)])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["visible"]),L("div",D,[O(P,{type:"primary",shape:"round",onClick:a[10]||(a[10]=e=>le(!1))},{icon:I((()=>[O(ue)])),default:I((()=>[E(" "+H(e.$t("tableOption.preview")),1)])),_:1}),O(P,{type:"primary",style:{"margin-left":"20px"},shape:"round",onClick:a[11]||(a[11]=e=>le(!0))},{icon:I((()=>[O(ce)])),default:I((()=>[E(" "+H(e.$t("tableOption.gen_code")),1)])),_:1})]),k.value?(N(),T(W,{key:0,visible:k.value,"onUpdate:visible":a[12]||(a[12]=e=>k.value=e),preCode:q.value,"onUpdate:preCode":a[13]||(a[13]=e=>q.value=e)},null,8,["visible","preCode"])):G("",!0)])}}},[["__scopeId","data-v-2a7a719a"]]);export{J as default};
